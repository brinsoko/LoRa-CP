{% extends "base.html" %}
{% block title %}{{ _('Add User') if mode == 'add' else _('Edit User') }}{% endblock %}
{% block content %}
<h5 class="mb-3">{{ _('Add User') if mode == 'add' else _('Edit User') }}</h5>

<form method="post">
  <div class="mb-3">
    <label class="form-label">{{ _('Username') }}</label>
    <input class="form-control" type="text" name="username"
           value="{{ '' if mode=='add' else u.username }}" required>
  </div>

  {% if mode == 'add' %}
  <div class="mb-3">
    <label class="form-label">{{ _('Password') }}</label>
    <input class="form-control" type="password" name="password" minlength="8" required>
    <div class="form-text">{{ _('At least 8 characters; should not contain the username.') }}</div>
  </div>
  {% else %}
  <div class="mb-3">
    <label class="form-label">{{ _('New Password (optional)') }}</label>
    <input class="form-control" type="password" name="new_password" minlength="8">
  </div>
  <div class="mb-3">
    <label class="form-label">{{ _('Confirm New Password') }}</label>
    <input class="form-control" type="password" name="confirm_password" minlength="8">
  </div>
  {% endif %}

  <div class="mb-3">
    <label class="form-label">{{ _('Competition Role') }}</label>
    <select class="form-select" name="role" required>
      {% set cur = ('viewer' if mode=='add' else (membership.role if membership else 'viewer')) %}
      {% for r in ['viewer','judge','admin'] %}
      <option value="{{ r }}" {% if r == cur %}selected{% endif %}>{{ _(r) }}</option>
      {% endfor %}
    </select>
    <div class="form-text">{{ _('Roles apply per competition.') }}</div>
  </div>

  <div class="d-flex gap-2">
    <button class="btn btn-primary" type="submit">{{ _('Create') if mode == 'add' else _('Save') }}</button>
    <a class="btn btn-secondary" href="{{ url_for('users.list_users') }}">{{ _('Cancel') }}</a>
  </div>
</form>
{% endblock %}
