{% extends "base.html" %}
{% block title %}{{ 'Add User' if mode == 'add' else 'Edit User' }}{% endblock %}
{% block content %}
<h5 class="mb-3">{{ 'Add User' if mode == 'add' else 'Edit User' }}</h5>

<form method="post">
  <div class="mb-3">
    <label class="form-label">Username</label>
    <input class="form-control" type="text" name="username"
           value="{{ '' if mode=='add' else u.username }}" required>
  </div>

  {% if mode == 'add' %}
  <div class="mb-3">
    <label class="form-label">Password</label>
    <input class="form-control" type="password" name="password" minlength="8" required>
    <div class="form-text">At least 8 characters; should not contain the username.</div>
  </div>
  {% else %}
  <div class="mb-3">
    <label class="form-label">New Password (optional)</label>
    <input class="form-control" type="password" name="new_password" minlength="8">
  </div>
  <div class="mb-3">
    <label class="form-label">Confirm New Password</label>
    <input class="form-control" type="password" name="confirm_password" minlength="8">
  </div>
  {% endif %}

  <div class="mb-3">
    <label class="form-label">Role</label>
    <select class="form-select" name="role" required>
      {% set cur = (None if mode=='add' else u.role) %}
      {% for r in ['public','judge','admin'] %}
      <option value="{{ r }}" {% if r == cur %}selected{% endif %}>{{ r }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="d-flex gap-2">
    <button class="btn btn-primary" type="submit">{{ 'Create' if mode == 'add' else 'Save' }}</button>
    <a class="btn btn-secondary" href="{{ url_for('users.list_users') }}">Cancel</a>
  </div>
</form>
{% endblock %}